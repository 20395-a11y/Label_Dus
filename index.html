<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generator Label Koli</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
:root {
  --bg: #f7f2f6;
  --card: #fff;
  --text: #000;
  --primary-btn: #0d6efd;
  --secondary-btn: #6c757d;
}
body.dark {
  --bg: #121212;
  --card: #1e1e1e;
  --text: #fff;
  --primary-btn: #4e9af1;
  --secondary-btn: #495057;
}
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Segoe UI', sans-serif;
  margin:0;
  padding:0;
}

.container {
  max-width: 980px;
  margin:auto;
  background: var(--card);
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  margin-top: 20px;
  margin-bottom: 20px;
}

h3 {
  font-weight: bold;
}

.table-scroll {
  max-height: 300px;
  overflow-y: auto;
  border-radius: 8px;
}

.table-scroll thead th {
  position: sticky;
  top: 0;
  z-index: 2;
  background-color: var(--card);
}

table { font-size: 14px; width: 100%; }
td, th { vertical-align: middle; }

textarea { width: 100%; padding: 8px; font-family: monospace; border-radius:8px; }

.btn-custom {
  flex: 1 1 120px;
  margin-bottom: 6px;
}
.btn-group-wrap {
  display:flex;
  flex-wrap: wrap;
  gap:8px;
}

.card-example img{
  max-width:100%;
  height:auto;
  border-radius:8px;
  display:block;
  margin:auto;
}
</style>
</head>
<body>
<div class="container">

<h3 class="text-center mb-4">üì¶ Generator Label Koli</h3>

<div class="btn-group-wrap mb-3">
  <button class="btn btn-secondary btn-custom" onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>
  <button class="btn btn-dark btn-custom" id="toggleInputMode">Mode TXT</button>
  <button class="btn btn-success btn-custom" id="uploadBtn">Upload File</button>
  <button class="btn btn-primary btn-custom" onclick="generateData()">Generate</button>
  <button class="btn btn-warning btn-custom" onclick="exportExcel()">Export Excel</button>
  <button class="btn btn-danger btn-custom" onclick="resetAll()">Reset</button>
  <button class="btn btn-info btn-custom" id="downloadTemplate">Unduh Template</button>
</div>

<input type="file" id="fileInput" accept=".csv,.txt,.xls,.xlsx,.ods" hidden>

<!-- TEXTAREA MODE -->
<div id="txtInputDiv" style="display:none; margin-bottom:16px;">
  <textarea id="txtInput" rows="6" placeholder="ALOKASI 1,44&#10;ALOKASI 2,36"></textarea>
</div>

<!-- TABLE MODE -->
<h5>Input Alokasi</h5>
<div class="table-scroll mb-3" id="tableInputDiv">
<table class="table table-bordered table-striped" id="inputTable">
<thead class="table-primary">
<tr>
<th>Alokasi</th>
<th width="120">Qty</th>
</tr>
</thead>
<tbody>
<tr>
<td><input class="form-control" placeholder="ALOKASI 1"></td>
<td><input type="number" class="form-control" placeholder="44"></td>
</tr>
</tbody>
</table>
</div>

<h5>Hasil & Packing List</h5>
<div class="table-scroll mb-3">
<table class="table table-bordered table-striped" id="resultTable">
<thead class="table-primary">
<tr>
<th>Alokasi</th>
<th>Total</th>
<th>Koli 18</th>
<th>Plastik 5</th>
<th>Koli Sisa</th>
<th>Detail Packing</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<p class="mt-2 text-muted"><b>üìå File harus berisi 2 kolom: Alokasi | Qty (tanpa header)</b></p>

<div class="card card-example p-3 mt-3 mb-3">
<h5 class="text-center">Contoh Isi File</h5>
<img src="https://i.ibb.co.com/pj7XkWpj/example-image.png" alt="example">
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script>
// VAR
const fileInput = document.getElementById('fileInput');
const txtInput = document.getElementById('txtInput');
const uploadBtn = document.getElementById('uploadBtn');
let mode = 'table';
const toggleInputBtn = document.getElementById('toggleInputMode');
const tableInputDiv = document.getElementById('tableInputDiv');
const txtInputDiv = document.getElementById('txtInputDiv');

// THEME
function toggleTheme(){ document.body.classList.toggle('dark'); }

// INPUT MODE
toggleInputBtn.addEventListener('click', ()=>{
  if(mode==='table'){
    tableInputDiv.style.display='none';
    txtInputDiv.style.display='block';
    toggleInputBtn.textContent='Mode Table';
    mode='txt';
  } else {
    tableInputDiv.style.display='block';
    txtInputDiv.style.display='none';
    toggleInputBtn.textContent='Mode TXT';
    mode='table';
  }
});

// FILE UPLOAD
uploadBtn.addEventListener('click', ()=> fileInput.click());
fileInput.addEventListener('change', handleFile);

function handleFile(e){
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = evt=>{
    const data = new Uint8Array(evt.target.result);
    const wb = XLSX.read(data,{type:'array'});
    const sheet = wb.Sheets[wb.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet,{header:1});
    fillInput(rows);
  };
  reader.readAsArrayBuffer(file);
}

function fillInput(rows){
  const tbody = document.querySelector('#inputTable tbody');
  tbody.innerHTML='';
  rows.forEach(r=>{
    if(!r[0] || isNaN(r[1])) return;
    tbody.insertAdjacentHTML('beforeend',`
      <tr>
        <td><input class="form-control" value="${r[0]}"></td>
        <td><input type="number" class="form-control" value="${r[1]}"></td>
      </tr>
    `);
  });
}

// HITUNG KOLI
function hitungKoli(qty){
  const koli18 = Math.floor(qty/18);
  let sisa = qty % 18;
  const plastik5 = Math.floor(sisa/5);
  sisa = sisa % 5;
  return {koli18, plastik5, koliSisa:sisa>0?1:0, sisaQty:sisa};
}

function detailPacking(qty){
  const h = hitungKoli(qty);
  return `${h.koli18} koli x 18 = ${h.koli18*18}<br>${h.plastik5} plastik x 5 = ${h.plastik5*5}<br>Sisa eceran = ${h.sisaQty}`;
}

// GENERATE
function generateData(){
  const tbody = document.querySelector('#resultTable tbody');
  tbody.innerHTML='';
  let rows=[];
  if(mode==='table'){
    document.querySelectorAll('#inputTable tbody tr').forEach(r=>{
      const alokasi = r.cells[0].querySelector('input').value.trim();
      const qty = parseInt(r.cells[1].querySelector('input').value);
      if(alokasi && qty>0) rows.push({alokasi, qty});
    });
  } else {
    txtInput.value.trim().split(/\r?\n/).forEach(line=>{
      if(!line) return;
      let parts = line.includes(',')? line.split(','):line.split(/\t/);
      const alokasi = parts[0].trim();
      const qty = parseInt(parts[1]);
      if(alokasi && !isNaN(qty)) rows.push({alokasi, qty});
    });
  }
  rows.forEach(r=>{
    const h = hitungKoli(r.qty);
    tbody.insertAdjacentHTML('beforeend',`
      <tr>
        <td>${r.alokasi}</td>
        <td>${r.qty}</td>
        <td>${h.koli18}</td>
        <td>${h.plastik5}</td>
        <td>${h.koliSisa}</td>
        <td>${detailPacking(r.qty)}</td>
      </tr>
    `);
  });
}

// EXPORT
function exportExcel(){
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.table_to_sheet(resultTable,{raw:true});
  XLSX.utils.book_append_sheet(wb, ws,'Packing List');
  XLSX.writeFile(wb,'packing_list.xlsx');
}

// RESET
function resetAll(){
  document.querySelector('#inputTable tbody').innerHTML=`
    <tr><td><input class="form-control"></td><td><input type="number" class="form-control"></td></tr>`;
  document.querySelector('#resultTable tbody').innerHTML='';
  fileInput.value='';
  txtInput.value='';
}

// DOWNLOAD TEMPLATE
document.getElementById('downloadTemplate').addEventListener('click', function() {
    // Data template 
    const data = [
        ["Alokasi", "Qty"],   
        ["ALOKASI 1", ""],
        ["ALOKASI 2", ""],
        ["ALOKASI 3", ""]
    ];

    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet(data); 
    XLSX.utils.book_append_sheet(wb, ws, "Template");

    XLSX.writeFile(wb, "template_label.ods", { bookType: "ods" });
});
</script>
</body>
</html>
